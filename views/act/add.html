<link href="/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
<script src="/js/bootstrap-datetimepicker.min.js"></script>
<script src="/js/bootstrap-datetimepicker.zh-CN.js"></script>
<link href="/ueditor/themes/default/css/umeditor.min.css" type="text/css" rel="stylesheet"/>
<script type="text/javascript" charset="utf-8" src="/ueditor/umeditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="/ueditor/umeditor.min.js"></script>
<script type="text/javascript" src="/ueditor/lang/zh-cn/zh-cn.js"></script>
<script src="/frontia/Baidu-Frontia-JS-1.0.0.js"></script>
    <!-- inc template file -->
    
    
    <!-- html var -->
    

    <!-- Callout for the old docs link -->
    

    <div class="container bs-docs-container">
      <div class="row">
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">
                <li class="active"><a href="/act/list">活动管理</a></li>
                <li><a href="/act/cate">活动分类</a></li>
                <li><a href="/act/join">报名管理</a></li>
                <li><a href="/user/list">用户管理</a></li>
            </ul>
          </div>
        </div>
        
        <div class="col-md-9" role="main">
          <!-- Global Bootstrap settings
          ================================================== -->
          <div class="bs-docs-section">
            <div class="page-header">
              <h3 id="overview">{{title}}</h3>
            </div>
            <div class="">
              <form class="form-horizontal" role="form" method="post"  enctype='multipart/form-data'>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动名称/标题</label>
                    <div class="col-sm-10">
                      <input type="text" name="title" class="form-control" placeholder="活动名称/标题" value="{{actInfo.title}}"/>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动分类</label>
                    <div class="col-sm-3">
                      <select class="form-control" name="cate_title">
                      {{#if actInfo.cate_title}}
                      <option value="{{actInfo.cate_title}}">{{actInfo.cate_title}}</option>
                      {{/if}}
                      {{#each cates}}
                        <option value="{{this.title}}">{{this.title}}</option>
                      {{/each}} 
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动时间</label>
                    <div class="col-sm-5">
                        <div class="input-group date form_datetime" data-date="" data-date-format="yyyy-mm-dd HH:ii" data-link-field="dtp_input1">
                        <input class="form-control" size="16" type="text" value="{{actInfo.act_time}}" readonly>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
    					<span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                        </div>
    				    <input type="hidden" name="act_time" id="dtp_input1" value="{{actInfo.act_time}}" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">结束时间</label>
                    <div class="col-sm-5">
                        <div class="input-group date form_datetime" data-date="" data-date-format="yyyy-mm-dd HH:ii" data-link-field="dtp_input2">
                        <input class="form-control" size="16" type="text" value="{{actInfo.end_time}}" readonly>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
    					<span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>
                        </div>
    				    <input type="hidden" name="end_time" id="dtp_input2" value="{{actInfo.end_time}}" />
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动地址</label>
                    <div class="col-sm-10">
                      <input type="text" name="address" class="form-control" placeholder="活动详细地址" value="{{actInfo.address}}">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动人数</label>
                    <div class="col-sm-2">
                      <input type="text" name="act_man" class="form-control" placeholder="活动人数" value="{{actInfo.act_man}}">
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动海报</label>
                    <div class="col-sm-5">
                      <input type="hidden" name="act_pic" id="act_pic" value="{{actInfo.act_pic}}" />
                      <input type="file" id="upload_act_pic" class="form-control"><span class="btn-primary">(808*200)</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">首页幻灯</label>
                    <div class="col-sm-5">
                      <input type="hidden" name="act_slide" id="act_slide" value="{{actInfo.act_slide}}" />
                      <input type="file" id="upload_act_slide" class="form-control"><span class="btn-info">(1002x352)</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">活动概述</label>
                    <div class="col-sm-10">
                      <textarea class="form-control" name="description" rows="3">{{actInfo.description}}</textarea>
                    </div>
                  </div>
                  <div class="form-group">
                    
                    <label class="col-sm-2 control-label">活动详情</label>
                    <div class="col-sm-10">
                      <script type="text/plain" id="content" style="width:100%;height:240px;">{{{actInfo.content}}}
</script>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">状态</label>
                    <div class="col-sm-10">
                        <div class="radio">
                          <label>
                            <input type="radio" name="state" id="optionsRadios1" value="0" checked>
                            显示
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="state" id="optionsRadios2" value="1" {{#if actInfo.state}} checked {{/if}} >
                            隐藏
                          </label>
                        </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="col-sm-2 control-label">推荐</label>
                    <div class="col-sm-10">
                        <div class="radio">
                          <label>
                            <input type="radio" name="is_recommend" id="optionsRadios1" value="0" checked>
                            否
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="is_recommend" id="optionsRadios2" value="1" {{#if actInfo.is_recommend}} checked {{/if}} >
                            是
                          </label>
                        </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                      <input type="hidden" name="id" value="{{actInfo._id}}" />  
                      <button type="submit" class="btn btn-primary">发布</button>
                    </div>
                  </div>
                </form>
            </div>
          </div>
        </div>
        
      </div>

    </div>
<script>
$('.form_datetime').datetimepicker({
        language: 'zh-CN'
        //weekStart: 1,
        //todayBtn:  1,
		//autoclose: 1,
		//todayHighlight: 1,
		//startView: 2,
		//forceParse: 0,
        //showMeridian: 1
});
//实例化编辑器
var ue = UM.getEditor('content');

  /**
   * @param {baidu.frontia} fronta
   * @param {baidu.frontia.File} fFile
   * @param {baidu.frontia.ACL} ACL
   * @param {baidu.frontia.Role} Role
   * @param {baidu.frontia.storage} storage
   */
  (function (frontia, fFile, ACL, Role, storage) {
    var AK = 'gyFG80njksqzyzwyiDxc3Irv';
    // 初始化 frontia
    frontia.init(AK);
    // 创建一种角色，后续上传的文件对该角色有对应读写权限
    var role = new Role('role_public');//role_name
    
    $('#upload_act_pic').change(function(ev){
        var h5file = document.getElementById('upload_act_pic').files[0];
        // 设置上传到云存储的 路径及文件名
        var filename = '/act/' + h5file.name;
        // 初始化一个 frontia.File 对象
        var frontiaFile = new fFile(h5file, filename);
        // 初始化一个权限控制对象
        var acl = new ACL();
        // 对前文创建的角色 role 设置读写权限
        acl.setReadAccess(role, true);
        acl.setWriteAccess(role, true);
        // 设置 frontia.File 对象的读写权限
        frontiaFile.setAcl(acl);
        // 上传成功|失败的回调函数
        var options = {
            success: function(response) {
              // 设置当前执行环境的角色
              frontia.setCurrentAccount(role);
              var filename = response.response_params.object;
              // 根据 路径和文件名 查找该文件的下载地址
              storage.getFileUrl(filename, {
                success: function(response){
                  var url = ((response || {}).response_params || {}).url || '';
                  if(!h5file.type.match(/image.*/)) {
                    alert('请选择图片文件上传！')
                  } else {
                    document.getElementById('act_pic').value = url;
                  }
                },
                error: function() {
                  console.log(arguments);
                }
              })
            },
            error: function(err) {
              console.log(err);
            }
        };
        // 上传
        storage.uploadFile(frontiaFile, options);
    });
    
    $('#upload_act_slide').change(function(ev){
        var h5file = document.getElementById('upload_act_slide').files[0];
        // 设置上传到云存储的 路径及文件名
        var filename = '/act/' + h5file.name;
        // 初始化一个 frontia.File 对象
        var frontiaFile = new fFile(h5file, filename);
        // 初始化一个权限控制对象
        var acl = new ACL();
        // 对前文创建的角色 role 设置读写权限
        acl.setReadAccess(role, true);
        acl.setWriteAccess(role, true);
        // 设置 frontia.File 对象的读写权限
        frontiaFile.setAcl(acl);
        // 上传成功|失败的回调函数
        var options = {
            success: function(response) {
              // 设置当前执行环境的角色
              frontia.setCurrentAccount(role);
              var filename = response.response_params.object;
              // 根据 路径和文件名 查找该文件的下载地址
              storage.getFileUrl(filename, {
                success: function(response){
                  var url = ((response || {}).response_params || {}).url || '';
                  if(!h5file.type.match(/image.*/)) {
                    alert('请选择图片文件上传！')
                  } else {
                    document.getElementById('act_slide').value = url;
                  }
                },
                error: function() {
                  console.log(arguments);
                }
              })
            },
            error: function(err) {
              console.log(err);
            }
        };
        // 上传
        storage.uploadFile(frontiaFile, options);
    });

  }(baidu.frontia, baidu.frontia.File, baidu.frontia.ACL, baidu.frontia.Role, baidu.frontia.storage));
</script>